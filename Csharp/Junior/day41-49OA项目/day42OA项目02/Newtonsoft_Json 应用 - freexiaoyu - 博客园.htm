<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3c.org/TR/1999/REC-html401-19991224/loose.dtd">
<!-- saved from url=(0065)http://www.cnblogs.com/freexiaoyu/archive/2012/08/21/2649333.html -->
<HTML xmlns="http://www.w3.org/1999/xhtml"><HEAD><META content="IE=8.0000" 
http-equiv="X-UA-Compatible">
<TITLE>Newtonsoft.Json 应用 - freexiaoyu - 博客园</TITLE>
<META content="text/html; charset=utf-8" http-equiv=Content-Type><LINK 
rel=stylesheet type=text/css 
href="Newtonsoft_Json%20应用%20-%20freexiaoyu%20-%20博客园_files/common.css"><LINK 
id=MainCss rel=stylesheet type=text/css 
href="Newtonsoft_Json%20应用%20-%20freexiaoyu%20-%20博客园_files/style.css"><LINK 
rel=stylesheet type=text/css 
href="Newtonsoft_Json%20应用%20-%20freexiaoyu%20-%20博客园_files/common2.css"><LINK 
rel=stylesheet type=text/css 
href="Newtonsoft_Json%20应用%20-%20freexiaoyu%20-%20博客园_files/shStyle.css"><LINK 
title=RSS rel=alternate type=application/rss+xml 
href="http://www.cnblogs.com/freexiaoyu/rss"><LINK title=RSD rel=EditURI 
type=application/rsd+xml href="http://www.cnblogs.com/freexiaoyu/rsd.xml"><LINK 
rel=wlwmanifest type=application/wlwmanifest+xml 
href="http://www.cnblogs.com/freexiaoyu/wlwmanifest.xml">
<SCRIPT type=text/javascript 
src="Newtonsoft_Json%20应用%20-%20freexiaoyu%20-%20博客园_files/jquery.js"></SCRIPT>

<SCRIPT type=text/javascript>
var currentBlogApp = 'freexiaoyu';
</SCRIPT>

<SCRIPT type=text/javascript 
src="Newtonsoft_Json%20应用%20-%20freexiaoyu%20-%20博客园_files/common.js"></SCRIPT>

<SCRIPT type=text/javascript 
src="Newtonsoft_Json%20应用%20-%20freexiaoyu%20-%20博客园_files/json2.js"></SCRIPT>

<SCRIPT type=text/javascript 
src="Newtonsoft_Json%20应用%20-%20freexiaoyu%20-%20博客园_files/syntaxHighlighter.js"></SCRIPT>

<META name=GENERATOR content="MSHTML 8.00.7600.17267"></HEAD>
<BODY><A name=top></A><!--done-->
<DIV id=header><!--done-->
<DIV class=header>
<DIV class=headerText><A id=Header1_HeaderTitle class=headermaintitle 
href="http://www.cnblogs.com/freexiaoyu/">今天的付出等于明天的收获</A><BR></DIV></DIV></DIV>
<DIV id=mytopmenu>
<DIV id=mylinks><!--done--><A id=MyLinks1_HomeLink class=menu 
href="http://www.cnblogs.com/">博客园</A> &nbsp; <A id=MyLinks1_MyHomeLink 
class=menu href="http://www.cnblogs.com/freexiaoyu/">首页</A> &nbsp; <A class=menu 
href="http://q.cnblogs.com/">博问</A> &nbsp; <A class=menu 
href="http://home.cnblogs.com/ing/">闪存</A> &nbsp; <A id=MyLinks1_NewPostLink 
class=menu href="http://www.cnblogs.com/freexiaoyu/admin/EditPosts.aspx?opt=1" 
rel=nofollow>新随笔</A> &nbsp; <A id=MyLinks1_ContactLink class=menu 
href="http://space.cnblogs.com/msg/send/freexiaoyu" rel=nofollow>联系</A> &nbsp; 
<A id=MyLinks1_Syndication class=menu 
href="http://www.cnblogs.com/freexiaoyu/rss">订阅</A><A id=MyLinks1_XMLLink 
href="http://www.cnblogs.com/freexiaoyu/rss"><IMG alt=订阅 
src="Newtonsoft_Json%20应用%20-%20freexiaoyu%20-%20博客园_files/xml.gif"></A>&nbsp; 
<A id=MyLinks1_Admin class=menu 
href="http://www.cnblogs.com/freexiaoyu/admin/EditPosts.aspx" 
rel=nofollow>管理</A> </DIV>
<DIV id=mystats><!--done-->随笔-192&nbsp; 评论-93&nbsp; 文章-0&nbsp; trackbacks-0 
</DIV></DIV>
<DIV id=centercontent>
<DIV class=post>
<H1 class=postTitle><A id=cb_post_title_url class=postTitle2 
href="http://www.cnblogs.com/freexiaoyu/archive/2012/08/21/2649333.html">Newtonsoft.Json 
应用</A></H1>
<DIV id=cnblogs_post_body>
<P>Newtonsoft.Json下载地址<A 
href="http://json.codeplex.com/">http://json.codeplex.com/</A></P>
<P>根据自己的项目生成DLL并引用</P>
<P>JSON格式为</P><PRE>{"result":"200","info":[{"_cid":5,"_name":"Iphone4","_parentid":2,"_status":true},{"_cid":7,"_name":"手机外套","_parentid":2,"_status":true},{"_cid":8,"_name":"手机模","_parentid":2,"_status":true}]}<BR><BR>解析JOSN</PRE>
<DIV class=cnblogs_code 
onclick="cnblogs_code_show('8ae9370a-9074-4671-a72f-537f9f9e21fd')"><IMG 
id=code_img_closed_8ae9370a-9074-4671-a72f-537f9f9e21fd class=code_img_closed 
alt="" 
src="Newtonsoft_Json%20应用%20-%20freexiaoyu%20-%20博客园_files/ContractedBlock.gif"><IMG 
style="DISPLAY: none" id=code_img_opened_8ae9370a-9074-4671-a72f-537f9f9e21fd 
class=code_img_opened 
onclick="cnblogs_code_hide('8ae9370a-9074-4671-a72f-537f9f9e21fd',event)" alt="" 
src="Newtonsoft_Json%20应用%20-%20freexiaoyu%20-%20博客园_files/ExpandedBlockStart.gif"><SPAN 
class=cnblogs_code_collapse>View Code </SPAN>
<DIV id=cnblogs_code_open_8ae9370a-9074-4671-a72f-537f9f9e21fd 
class=cnblogs_code_hide><PRE> Maticsoft.Model.BackInfo backinfo =<SPAN style="COLOR: #000000"> (Maticsoft.Model.BackInfo)
                 JsonConvert.DeserializeObject(JsonData, </SPAN><SPAN style="COLOR: #0000ff">typeof</SPAN><SPAN style="COLOR: #000000">(Maticsoft.Model.BackInfo)); 

             </SPAN><SPAN style="COLOR: #0000ff">if</SPAN> (backinfo.result == <SPAN style="COLOR: #800000">"</SPAN><SPAN style="COLOR: #800000">200</SPAN><SPAN style="COLOR: #800000">"</SPAN>)<SPAN style="COLOR: #008000">//</SPAN><SPAN style="COLOR: #008000">成功</SPAN>
<SPAN style="COLOR: #000000">             {
                 List</SPAN>&lt;Maticsoft.Model.IphoneClassify&gt; list =<SPAN style="COLOR: #000000"> backinfo.info;
                 Dictionary</SPAN>&lt;<SPAN style="COLOR: #0000ff">int</SPAN>, String&gt; dic = <SPAN style="COLOR: #0000ff">new</SPAN> System.Collections.Generic.Dictionary&lt;<SPAN style="COLOR: #0000ff">int</SPAN>, String&gt;<SPAN style="COLOR: #000000">();
                 </SPAN><SPAN style="COLOR: #0000ff">for</SPAN> (<SPAN style="COLOR: #0000ff">int</SPAN> i = <SPAN style="COLOR: #800080">0</SPAN>; i &lt; list.Count; i++<SPAN style="COLOR: #000000">)
                 {
                     Maticsoft.Model.IphoneClassify classify </SPAN>=<SPAN style="COLOR: #000000"> (Maticsoft.Model.IphoneClassify)list[i];
                     dic.Add(classify._cid, classify._name);
                 }
                 </SPAN><SPAN style="COLOR: #0000ff">this</SPAN>.DataList1.DataSource =<SPAN style="COLOR: #000000"> dic;
                 </SPAN><SPAN style="COLOR: #0000ff">this</SPAN><SPAN style="COLOR: #000000">.DataList1.DataBind();
             }
             </SPAN><SPAN style="COLOR: #0000ff">else</SPAN><SPAN style="COLOR: #000000"> { 
                </SPAN><SPAN style="COLOR: #008000">//</SPAN><SPAN style="COLOR: #008000">失败</SPAN>
             }</PRE></DIV></DIV>
<P>这里特别注意的是 JSON的字段要和Model类的属性名保持一至不然返回Null 就是这个问题研究半天才弄明白，多谢<A 
href="http://smalltalk.cnblogs.com/">http://smalltalk.cnblogs.com/</A>和<A 
href="http://www.cnblogs.com/xiaopohou/">http://www.cnblogs.com/xiaopohou/</A></P>
<P>的帮忙</P>
<P>我的model类是用动软生成 的</P>
<P>最后将model类改为&nbsp;</P>
<DIV class=cnblogs_code 
onclick="cnblogs_code_show('c21a780a-8719-4f1a-b05b-84ab007ca088')"><IMG 
id=code_img_closed_c21a780a-8719-4f1a-b05b-84ab007ca088 class=code_img_closed 
alt="" 
src="Newtonsoft_Json%20应用%20-%20freexiaoyu%20-%20博客园_files/ContractedBlock.gif"><IMG 
style="DISPLAY: none" id=code_img_opened_c21a780a-8719-4f1a-b05b-84ab007ca088 
class=code_img_opened 
onclick="cnblogs_code_hide('c21a780a-8719-4f1a-b05b-84ab007ca088',event)" alt="" 
src="Newtonsoft_Json%20应用%20-%20freexiaoyu%20-%20博客园_files/ExpandedBlockStart.gif"><SPAN 
class=cnblogs_code_collapse>View Code </SPAN>
<DIV id=cnblogs_code_open_c21a780a-8719-4f1a-b05b-84ab007ca088 
class=cnblogs_code_hide><PRE><SPAN style="COLOR: #0000ff">using</SPAN><SPAN style="COLOR: #000000"> System;
</SPAN><SPAN style="COLOR: #0000ff">using</SPAN><SPAN style="COLOR: #000000"> System.Collections.Generic;
</SPAN><SPAN style="COLOR: #0000ff">using</SPAN><SPAN style="COLOR: #000000"> System.Linq;
</SPAN><SPAN style="COLOR: #0000ff">using</SPAN><SPAN style="COLOR: #000000"> System.Text;

</SPAN><SPAN style="COLOR: #0000ff">namespace</SPAN><SPAN style="COLOR: #000000"> Maticsoft.Model
{
    </SPAN><SPAN style="COLOR: #808080">///</SPAN> <SPAN style="COLOR: #808080">&lt;summary&gt;</SPAN>
    <SPAN style="COLOR: #808080">///</SPAN><SPAN style="COLOR: #008000">返回JSON属性
    </SPAN><SPAN style="COLOR: #808080">///</SPAN> <SPAN style="COLOR: #808080">&lt;/summary&gt;</SPAN>
<SPAN style="COLOR: #000000">    [Serializable]
   </SPAN><SPAN style="COLOR: #0000ff">public</SPAN> <SPAN style="COLOR: #0000ff">class</SPAN><SPAN style="COLOR: #000000"> BackInfo
    { 
       </SPAN><SPAN style="COLOR: #0000ff">public</SPAN><SPAN style="COLOR: #000000"> BackInfo() { 
           
       }
        </SPAN><SPAN style="COLOR: #0000ff">public</SPAN> String result { <SPAN style="COLOR: #0000ff">get</SPAN>; <SPAN style="COLOR: #0000ff">set</SPAN><SPAN style="COLOR: #000000">; }
        </SPAN><SPAN style="COLOR: #0000ff">public</SPAN> List&lt;IphoneClassify&gt; info { <SPAN style="COLOR: #0000ff">get</SPAN>; <SPAN style="COLOR: #0000ff">set</SPAN><SPAN style="COLOR: #000000">; }
    }

    </SPAN><SPAN style="COLOR: #808080">///</SPAN> <SPAN style="COLOR: #808080">&lt;summary&gt;</SPAN>
    <SPAN style="COLOR: #808080">///</SPAN><SPAN style="COLOR: #008000">产品类型
    </SPAN><SPAN style="COLOR: #808080">///</SPAN> <SPAN style="COLOR: #808080">&lt;/summary&gt;</SPAN>
<SPAN style="COLOR: #000000">    [Serializable]
    </SPAN><SPAN style="COLOR: #0000ff">public</SPAN> <SPAN style="COLOR: #0000ff">class</SPAN><SPAN style="COLOR: #000000"> IphoneClassify
    {
        </SPAN><SPAN style="COLOR: #0000ff">public</SPAN> <SPAN style="COLOR: #0000ff">int</SPAN> _cid { <SPAN style="COLOR: #0000ff">get</SPAN>; <SPAN style="COLOR: #0000ff">set</SPAN><SPAN style="COLOR: #000000">; }
        </SPAN><SPAN style="COLOR: #0000ff">public</SPAN> <SPAN style="COLOR: #0000ff">string</SPAN> _name { <SPAN style="COLOR: #0000ff">get</SPAN>; <SPAN style="COLOR: #0000ff">set</SPAN><SPAN style="COLOR: #000000">; }
        </SPAN><SPAN style="COLOR: #0000ff">public</SPAN> <SPAN style="COLOR: #0000ff">int</SPAN> _parentid { <SPAN style="COLOR: #0000ff">get</SPAN>; <SPAN style="COLOR: #0000ff">set</SPAN><SPAN style="COLOR: #000000">; }
        </SPAN><SPAN style="COLOR: #0000ff">public</SPAN> <SPAN style="COLOR: #0000ff">bool</SPAN> _status { <SPAN style="COLOR: #0000ff">get</SPAN>; <SPAN style="COLOR: #0000ff">set</SPAN><SPAN style="COLOR: #000000">; }

    }
}</SPAN></PRE></DIV></DIV>
<P>&nbsp;</P><PRE>序列化JOSN</PRE>
<DIV class=cnblogs_code 
onclick="cnblogs_code_show('df2d8785-ea1c-4de2-84ac-1beff80f8a66')"><IMG 
id=code_img_closed_df2d8785-ea1c-4de2-84ac-1beff80f8a66 class=code_img_closed 
alt="" 
src="Newtonsoft_Json%20应用%20-%20freexiaoyu%20-%20博客园_files/ContractedBlock.gif"><IMG 
style="DISPLAY: none" id=code_img_opened_df2d8785-ea1c-4de2-84ac-1beff80f8a66 
class=code_img_opened 
onclick="cnblogs_code_hide('df2d8785-ea1c-4de2-84ac-1beff80f8a66',event)" alt="" 
src="Newtonsoft_Json%20应用%20-%20freexiaoyu%20-%20博客园_files/ExpandedBlockStart.gif"><SPAN 
class=cnblogs_code_collapse>View Code </SPAN>
<DIV id=cnblogs_code_open_df2d8785-ea1c-4de2-84ac-1beff80f8a66 
class=cnblogs_code_hide><PRE> DataTable dt = <SPAN style="COLOR: #0000ff">new</SPAN> Maticsoft.BLL.Iphone_Classify().GetList(<SPAN style="COLOR: #800000">"</SPAN><SPAN style="COLOR: #800000">parentID=</SPAN><SPAN style="COLOR: #800000">"</SPAN> + strParentID).Tables[<SPAN style="COLOR: #800080">0</SPAN><SPAN style="COLOR: #000000">];
                </SPAN><SPAN style="COLOR: #0000ff">if</SPAN> (dt.Rows.Count &gt; <SPAN style="COLOR: #800080">0</SPAN><SPAN style="COLOR: #000000">)
                {
                    List</SPAN>&lt;Maticsoft.Model.Iphone_Classify&gt; list = <SPAN style="COLOR: #0000ff">new</SPAN> List&lt;Model.Iphone_Classify&gt;<SPAN style="COLOR: #000000">();
                    </SPAN><SPAN style="COLOR: #0000ff">foreach</SPAN> (DataRow row <SPAN style="COLOR: #0000ff">in</SPAN><SPAN style="COLOR: #000000"> dt.Rows)
                    {
                        Maticsoft.Model.Iphone_Classify model </SPAN>= <SPAN style="COLOR: #0000ff">new</SPAN><SPAN style="COLOR: #000000"> Model.Iphone_Classify()
                        {
                            CID </SPAN>= <SPAN style="COLOR: #0000ff">int</SPAN>.Parse(row[<SPAN style="COLOR: #800000">"</SPAN><SPAN style="COLOR: #800000">CID</SPAN><SPAN style="COLOR: #800000">"</SPAN><SPAN style="COLOR: #000000">].ToString()),
                            Name </SPAN>= row[<SPAN style="COLOR: #800000">"</SPAN><SPAN style="COLOR: #800000">Name</SPAN><SPAN style="COLOR: #800000">"</SPAN><SPAN style="COLOR: #000000">].ToString(),
                            parentID </SPAN>= <SPAN style="COLOR: #0000ff">int</SPAN>.Parse(row[<SPAN style="COLOR: #800000">"</SPAN><SPAN style="COLOR: #800000">parentID</SPAN><SPAN style="COLOR: #800000">"</SPAN><SPAN style="COLOR: #000000">].ToString()),
                            Status </SPAN>= <SPAN style="COLOR: #0000ff">bool</SPAN>.Parse(row[<SPAN style="COLOR: #800000">"</SPAN><SPAN style="COLOR: #800000">Status</SPAN><SPAN style="COLOR: #800000">"</SPAN><SPAN style="COLOR: #000000">].ToString())
                        };
                        list.Add(model);
                    }
                    </SPAN><SPAN style="COLOR: #008000">//</SPAN><SPAN style="COLOR: #008000">微软的JSON序列化
                   </SPAN><SPAN style="COLOR: #008000">//</SPAN><SPAN style="COLOR: #008000"> Classifyinfo = Json.JsonInfo("200", Json.CompanyJsonSerializer&lt;List&lt;Maticsoft.Model.Iphone_Classify&gt;&gt;(list));
                    </SPAN><SPAN style="COLOR: #008000">//</SPAN><SPAN style="COLOR: #008000"> Newtonsoft.Json</SPAN>
                    Classifyinfo = Json.JsonInfo(<SPAN style="COLOR: #800000">"</SPAN><SPAN style="COLOR: #800000">200</SPAN><SPAN style="COLOR: #800000">"</SPAN><SPAN style="COLOR: #000000">, JsonConvert.SerializeObject(list));
                }
                </SPAN><SPAN style="COLOR: #0000ff">else</SPAN><SPAN style="COLOR: #000000">
                {
                    Classifyinfo </SPAN>= Json.JsonInfo(<SPAN style="COLOR: #800000">"</SPAN><SPAN style="COLOR: #800000">400</SPAN><SPAN style="COLOR: #800000">"</SPAN>, <SPAN style="COLOR: #800000">"</SPAN><SPAN style="COLOR: #800000">未找到相应数据</SPAN><SPAN style="COLOR: #800000">"</SPAN><SPAN style="COLOR: #000000">);
                }</SPAN></PRE></DIV></DIV>
<P>&nbsp;</P><PRE><BR><BR></PRE></DIV>
<DIV id=MySignature></DIV>
<SCRIPT type=text/javascript>
var isLogined = false;
var cb_blogId = 36140;
var cb_entryId = 2649333;
var cb_blogApp = currentBlogApp;
var cb_blogUserGuid = "a736420b-63cf-dd11-9e4d-001cf0cd104b";
var cb_entryCreatedDate = '2012/8/21 16:36:00';
var enableGoogleAd = true;
var googletag = googletag || {};
googletag.cmd = googletag.cmd || [];
</SCRIPT>

<DIV class=clear></DIV>
<DIV id=blog_post_info_block>
<DIV id=blog_post_info></DIV>
<DIV class=clear></DIV>
<DIV id=post_next_prev></DIV></DIV>
<SCRIPT type=text/javascript>
    //SyntaxHighlighter.config.strings.expandSource = '<span><img src="http://static.cnblogs.com/images/expand-code.gif" alt="" class="expand-code-icon"/>View Code</span>';
    $(function () {  
        loadViewCount(cb_entryId);
        fixPostBodyFormat();
        loadAdUnderPost();
        loadBlogSignature();
        LoadPostInfoBlock(cb_blogId, cb_entryId, cb_blogApp, cb_blogUserGuid);
        GetPrevNextPost(cb_entryId, cb_blogId, cb_entryCreatedDate);        
        GetHistoryToday(cb_blogId, cb_blogApp, cb_entryCreatedDate);        
    });
</SCRIPT>

<DIV class=postDesc>posted on <SPAN id=post-date>2012-08-21 16:36</SPAN> <A 
href="http://www.cnblogs.com/freexiaoyu/">freexiaoyu</A> 阅读(<SPAN 
id=post_view_count>...</SPAN>) 评论(<SPAN id=post_comment_count>...</SPAN>) <A 
href="http://www.cnblogs.com/freexiaoyu/admin/EditPosts.aspx?postid=2649333" 
rel=nofollow>编辑</A> <A onclick="AddToWz(2649333);return false;" 
href="http://www.cnblogs.com/freexiaoyu/archive/2012/08/21/2649333.html#">收藏</A></DIV></DIV>
<SCRIPT type=text/javascript 
src="Newtonsoft_Json%20应用%20-%20freexiaoyu%20-%20博客园_files/2649333"></SCRIPT>

<DIV id=blog-comments-placeholder></DIV>
<SCRIPT type=text/javascript>var commentManager = new blogCommentManager();commentManager.renderComments(0);</SCRIPT>

<DIV id=comment_form class=commentform>
<DIV id=divCommentShow></DIV>
<DIV id=comment_nav><SPAN id=span_refresh_tips></SPAN><A id=lnk_RefreshComments 
onclick="return RefreshCommentList();" href="javascript:void(0);">刷新评论</A><A 
onclick="return RefreshPage();" 
href="http://www.cnblogs.com/freexiaoyu/archive/2012/08/21/2649333.html#">刷新页面</A><A 
href="http://www.cnblogs.com/freexiaoyu/archive/2012/08/21/2649333.html#top">返回顶部</A></DIV>
<DIV id=comment_form_container></DIV>
<SCRIPT type=text/javascript>
    if (typeof commentManager === 'undefined') {
        commentManager = new blogCommentManager();
    }
    commentManager.loadCommentForm();   
</SCRIPT>

<DIV id=ad_text_under_commentbox class=ad_text_commentbox></DIV>
<DIV id=site_nav_under><A title=程序员的网上家园 href="http://www.cnblogs.com/" 
target=_blank>博客园首页</A><A title=程序员问答社区 href="http://q.cnblogs.com/" 
target=_blank>博问</A><A title=IT新闻 href="http://news.cnblogs.com/" 
target=_blank>新闻</A><A href="http://home.cnblogs.com/ing/" 
target=_blank>闪存</A><A href="http://job.cnblogs.com/" target=_blank>程序员招聘</A><A 
href="http://kb.cnblogs.com/" target=_blank>知识库</A></DIV>
<DIV id=ad_under_post_holder></DIV>
<DIV id=HistoryToday class=c_ad_block></DIV></DIV></DIV>
<DIV id=leftcontent>
<DIV id=leftcontentcontainer><!--done-->
<DIV class=newsItem>
<DIV id=blog-news></DIV></DIV>
<DIV style="DISPLAY: none" id=blog-calendar-block>
<DIV id=blog-calendar></DIV></DIV><BR>
<DIV id=blog-sidecolumn></DIV></DIV></DIV><!--done-->
<DIV class=footer>Powered by: <A href="http://www.cnblogs.com/">博客园</A> 模板提供：<A 
href="http://blog.hjenglish.com/">沪江博客</A> Copyright ©2013 freexiaoyu </DIV>
<SCRIPT type=text/javascript 
src="Newtonsoft_Json%20应用%20-%20freexiaoyu%20-%20博客园_files/google-analytics.js"></SCRIPT>
</BODY></HTML>
